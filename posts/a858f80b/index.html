<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="ä¸€äº›ç»éªŒçš„è®°å½•ã€‚"><meta name="author" content="Dusty Posa"><meta name="keywords" content="python,python3,process,script"><title>iterators,generators,coroutines - Posaã®ã«ã‚</title><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css"><link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"><link rel="stylesheet" href="/css/main.css"><link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><meta name="generator" content="Hexo 4.2.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Posaã®ã«ã‚</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/">é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/">å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/">åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/">æ ‡ç­¾</a></li><li class="nav-item"><a class="nav-link" href="/about/">å…³äº</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask rgba-black-light flex-center"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><p class="mt-3 post-meta"><i class="fas fa-calendar-alt" aria-hidden="true"></i> æ˜ŸæœŸäºŒ, å››æœˆ 7æ—¥ 2020, 10:10 ä¸Šåˆ</p><p class="mt-1"><span class="post-meta"><i class="far fa-chart-bar"></i> 3.9k å­— </span><span class="post-meta"><i class="far fa-clock"></i> 14 åˆ†é’Ÿ</span></p></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5 z-depth-3" id="board"><div class="post-content mx-auto" id="post"><p class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸäºŒ, å››æœˆ 14æ—¥ 2020, 6:14 æ—©ä¸Š</p><div class="markdown-body"><h2 id="Python-101-iterators-generators-coroutines"><a href="#Python-101-iterators-generators-coroutines" class="headerlink" title="Python 101: iterators,generators,coroutines"></a>Python 101: iterators,generators,coroutines</h2><blockquote><p>ä½œè€…ï¼š<br>Mark McDonnell<br>å‘å¸ƒæ—¶é—´: 2019-12-28<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.integralist.co.uk/posts/python-generators/" target="_blank" rel="noopener">https://www.integralist.co.uk/posts/python-generators/</a></p><p>ç¿»è¯‘:<br>Dustyposa</p></blockquote><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨<code>(generators)</code>ä»¥åŠå’Œåç¨‹<code>(coroutines)</code>ä½œæ¯”è¾ƒï¼Œä½†æ˜¯ä¸ºäº†äº†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µ<em>ï¼ˆç”Ÿæˆå™¨å’Œåç¨‹ï¼‰</em>æˆ‘ä»¬éœ€è¦å›å¤´çœ‹ä¸€çœ‹å¹¶äº†è§£è¿­ä»£å™¨<code>(Iterator)</code>çš„æ¦‚å¿µã€‚<br>æˆ‘ä»¬æœ€ç»ˆå°†ä¼šè®¨è®ºâ€¦</p><ul><li><a href="#è¿­ä»£å™¨">è¿­ä»£å™¨(Iterators)</a><ul><li><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨è¿­ä»£å™¨%3F">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿­ä»£å™¨ï¼Ÿ</a></li><li><a href="#è¿­ä»£å™¨çš„å®ç°">è¿­ä»£å™¨çš„å®ç°</a></li><li><a href="#è¿­ä»£å™¨ç¤ºä¾‹">è¿­ä»£å™¨ç¤ºä¾‹</a></li></ul></li><li><a href="#ç”Ÿæˆå™¨">ç”Ÿæˆå™¨(Generators)</a><ul><li><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ</a></li><li><a href="#ç”Ÿæˆå™¨çš„å®ç°">ç”Ÿæˆå™¨çš„å®ç°</a></li><li><a href="#ç”Ÿæˆå™¨ç¤ºä¾‹">ç”Ÿæˆå™¨ç¤ºä¾‹</a></li><li><a href="#ç”Ÿæˆå™¨è¡¨è¾¾å¼">ç”Ÿæˆå™¨è¡¨è¾¾å¼</a></li><li><a href="#ç”Ÿæˆå™¨åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šyield-fromï¼‰">åµŒå¥—ç”Ÿæˆå™¨ï¼ˆä¾‹å¦‚:yield fromï¼‰</a></li></ul></li><li><a href="#åç¨‹">åç¨‹(Coroutines)</a><ul><li><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åç¨‹ï¼Ÿ</a></li><li><a href="#åç¨‹çš„å®ç°">åç¨‹çš„å®ç°</a></li><li><a href="#åç¨‹ç¤ºä¾‹">åç¨‹ç¤ºä¾‹</a></li><li><a href="#Aysncio%3A-åŸºäºç”Ÿæˆå™¨çš„åç¨‹">Asyncio: åŸºäºç”Ÿæˆå™¨çš„åç¨‹</a></li><li><a href="#Asyncio%3A-æ–°çš„-async-åç¨‹">Asyncio: æ–°çš„ async åç¨‹</a></li><li><a href="#åç¨‹çš„ç§ç±»">åç¨‹çš„ç§ç±»</a></li><li><a href="#å…¶ä»–æ–¹é¢">å…¶ä»–æ–¹é¢</a></li></ul></li></ul><p>æ¯ä¸ªç« èŠ‚éƒ½ä¼šå¼•å¯¼åˆ°ä¸‹ä¸€ç« èŠ‚ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« çš„æœ€å¥½çš„é˜…è¯»æ–¹å¼å°±æ˜¯æŒ‰ç…§é»˜è®¤ç« èŠ‚çš„é¡ºåºã€‚é™¤éä½ å·²ç»ç†Ÿæ‚‰å‰é¢çš„éƒ¨åˆ†ï¼Œæ›´å–œæ¬¢è·³è¯»ã€‚</p><h3 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h3><hr><p>åœ¨ä¹‹åæˆ‘ä»¬å°†è®¨è®ºçš„æ‰€æœ‰ä¸œè¥¿çš„æ‘˜è¦å¦‚ä¸‹ï¼š</p><ul><li>è¿­ä»£å™¨å…è®¸ä½ å¯¹è‡ªå®šä¹‰å¯¹è±¡è¿›è¡Œè¿­ä»£</li><li>ç”Ÿæˆå™¨æ„å»ºäºè¿­ä»£å™¨ä¹‹ä¸Šï¼ˆå®ƒä»¬è¾ƒå°‘äº†æ¨¡ç‰ˆï¼‰ã€‚</li><li>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ¯”ç”Ÿæˆå™¨æ›´åŠ ç®€æ´</li><li>åç¨‹å°±<em>æ˜¯</em>ç”Ÿæˆå™¨ï¼Œä½†æ˜¯åç¨‹çš„<code>yield</code>è¯­å¥ä¼šæ¥æ”¶ä¸€ä¸ªå€¼ã€‚</li><li>åç¨‹å¯ä»¥æš‚åœå’Œé‡æ–°æ‰§è¡Œï¼ˆå¯¹äºå¹¶å‘æ¥è¯´æ˜¯éå¸¸å¥½çš„ï¼‰</li></ul><blockquote><p>â€  think <a href="https://gist.github.com/e5310d1082b0ff8307e39b71a6f9bae5" target="_blank" rel="noopener">comprehensions</a>.</p></blockquote><h3 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h3><hr><p>æ ¹æ®å®˜æ–¹<a href="https://docs.python.org/3.7/glossary.html#term-iterator" target="_blank" rel="noopener"><code>Pythonæœ¯è¯­è¡¨</code></a>ï¼Œ<em>è¿­ä»£å™¨</em>æ˜¯â€¦</p><blockquote><p>è¡¨ç¤ºæ•°æ®æµçš„å¯¹è±¡</p></blockquote><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨è¿­ä»£å™¨"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨è¿­ä»£å™¨" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨è¿­ä»£å™¨?"></a>ä¸ºä»€ä¹ˆä½¿ç”¨è¿­ä»£å™¨?</h3><p>è¿­ä»£å™¨æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå…è®¸ä½¿ç”¨æ ‡å‡†çš„<code>Python for-in</code>è¯­æ³•å¯¹ä»»æ„è‡ªå®šä¹‰å¯¹è±¡è¿›è¡Œè¿­ä»£ã€‚è¿™å°±æ˜¯å†…éƒ¨åˆ—è¡¨å’Œå­—å…¸ç±»å‹çš„å·¥ä½œæ–¹å¼ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å…è®¸<code>for-in</code>å¯¹å®ƒä»¬è¿›è¡Œè¿­ä»£ã€‚<br>æ›´é‡è¦çš„æ˜¯ï¼Œè¿­ä»£å™¨ï¼ˆæˆ‘ä»¬ä¼šå‘ç°ï¼‰éå¸¸èŠ‚çœå†…å­˜ï¼Œè¿™å°±æ„å‘³ç€ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªæä¾›æ— é™å…ƒç´ çš„åºåˆ—å¯è¿­ä»£å¯¹è±¡å¹¶ä¸”ä½ ä¼šå‘ç°ä½ çš„ç¨‹åºæ°¸è¿œä¸ä¼šè€—å°½å†…å­˜åˆ†é…ã€‚</p><h3 id="è¿­ä»£å™¨çš„å®ç°"><a href="#è¿­ä»£å™¨çš„å®ç°" class="headerlink" title="è¿­ä»£å™¨çš„å®ç°"></a>è¿­ä»£å™¨çš„å®ç°</h3><p>ä¸€ä¸ªè¿­ä»£å™¨æ˜¯ï¼ˆé€šå¸¸ï¼‰æ˜¯ä¸€ä¸ªå®ç°äº†<code>__iter__ and __next__</code><em>â€˜åŒä¸‹(dunder)â€™</em>æ–¹æ³•ï¼Œå°½ç®¡<code>__next__</code>æ–¹æ³•ä¸éœ€è¦ä½œä¸ºå®šä¹‰äº†<code>__iter__</code>æ–¹æ³•çš„å¯¹è±¡çš„ä¸€éƒ¨åˆ†è¢«å®šä¹‰ã€‚è®©æˆ‘æ¾„æ¸…ä¸€ä¸‹â€¦</p><p><code>&#39;è¿­ä»£å™¨&#39;</code>å®é™…ä¸Šåªæ˜¯ä¸€äº›æ•°æ®çš„å®¹å™¨ã€‚è¿™ä¸ª<code>&#39;å®¹å™¨&#39;</code>ï¼Œæ ¹æ®*<a href="https://docs.python.org/3.7/library/stdtypes.html#iterator.__iter__" target="_blank" rel="noopener">åè®®æ–‡æ¡£(protocol documentation)</a>*å¿…é¡»æœ‰ä¸€ä¸ª<code>__iter__</code>æ–¹æ³•ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼šä¸€äº›å«æœ‰<code>__next__</code>æ–¹æ³•çš„ä¸œè¥¿ï¼‰ã€‚<code>__next__</code>æ–¹æ³•ä¼šåœ¨ç›¸å…³æ•°æ®é›†ä¸­å‘å‰ç§»åŠ¨ã€‚</p><p>æ‰€ä»¥ï¼Œä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªåŒæ—¶åŒ…å«<code>__iter__ and __next__</code> æ–¹æ³•çš„å•ç±»<em>(single class)</em>(å°±åƒæˆ‘åœ¨ä¸‹é¢å±•ç¤ºçš„)ï¼Œæˆ–è€…ä½ å¯èƒ½æƒ³æŠŠ<code>__next__</code>æ–¹æ³•å®šä¹‰ä¸ºå•ç‹¬ç±»çš„ä¸€éƒ¨åˆ†ï¼ˆè¿™å–å†³äºä½ æ„Ÿè§‰çš„ä»€ä¹ˆæ˜¯å¯¹äºä½ é¡¹ç›®æ¥è¯´æœ€å¥½çš„æ–¹å¼ï¼‰ã€‚</p><blockquote><p>æ³¨æ„ï¼š<a href="https://docs.python.org/3.7/library/collections.abc.html#collections.abc.Iterator" target="_blank" rel="noopener">collections.abc</a>å¯¹åº”çš„<code>Python</code>æ–‡æ¡£å¼ºè°ƒäº†é‚£äº›<code>Pytrhon</code>æ‹¥æœ‰çš„ä»¥åŠå„ç§å®ƒä»¬éœ€è¦çš„æ–¹æ³•(å¯ä»¥çœ‹ä¸€äº›<a href="https://www.integralist.co.uk/posts/python-code-design/#interfaces-protocols-and-abstract-methods" target="_blank" rel="noopener">æˆ‘çš„æ—©æœŸæ–‡ç« </a>ï¼Œè¯¦ç»†è®¨è®ºäº†<code>protocols + abstract classes</code>)å…¶ä»–<em>â€˜åè®®(protocols)â€™*ã€‚å¦‚æœä½ å¯¹</em>â€˜åŒä¸‹â€™æ–¹æ³•è¿˜éƒ¨ä¸ç†Ÿæ‚‰ï¼Œæˆ‘ç»™ä½ æ¨èä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« :<a href="https://rszalski.github.io/magicmethods/" target="_blank" rel="noopener">é­”æœ¯æ–¹æ³•æŒ‡å—</a>*</p></blockquote><p>é€šè¿‡å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œèƒ½ä½¿<code>Python</code>è¿­ä»£ä¸€ä¸ªâ€™é›†åˆ(collection)â€™ã€‚å®ƒä¸å…³å¿ƒé›†åˆæ˜¯ä»€ä¹ˆï¼Œåªè¦è¿­ä»£å™¨å¯¹è±¡å®šä¹‰äº†<code>Python</code>çŸ¥é“å¦‚ä½•å»è¿­ä»£çš„è¡Œä¸ºã€‚</p><h3 id="è¿­ä»£å™¨ç¤ºä¾‹"><a href="#è¿­ä»£å™¨ç¤ºä¾‹" class="headerlink" title="è¿­ä»£å™¨ç¤ºä¾‹"></a>è¿­ä»£å™¨ç¤ºä¾‹</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ ·ä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºè¿™æ ·çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ä¼ é€’ç»™ç±»çš„æ„é€ å‡½æ•°ï¼Œè¯¥ç±»å®ç°äº†å…è®¸è¿›è¡Œ<code>for-in</code>è¿­ä»£æ•°æ®é›†åˆçš„ç›¸å…³æ–¹æ³•ã€‚</p><pre><code class="python">class Foo:
    def __init__(self, collection):
        self.collection = collection
        self.index = 0

    def __iter__(self):
        &quot;&quot;&quot;
        æˆ‘ä»¬è¿”å› selfï¼Œæ‰€ä»¥ &#39;iterator object&#39;å°±æ˜¯ Foo ç±»å®ä¾‹çš„æœ¬èº«ã€‚

        ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå®Œå…¨ä¸åŒçš„æ–°çš„å®ä¾‹ï¼Œåªè¦å¦ä¸€ä¸ª class åœ¨å®ƒä¸Šé¢å®šä¹‰äº† __next__ æ–¹æ³•ã€‚
        &quot;&quot;&quot;
        print(&#39;iter be called&#39;)
        return self

    def __next__(self):
        &quot;&quot;&quot;
        è¿™ä¸ªæ–¹æ³•å¤„ç†çŠ¶æ€å¹¶å‘è¿­ä»£å™¨å®¹å™¨é€šçŸ¥æˆ‘ä»¬ç›®å‰æŒ‡å‘çš„æˆ‘ä»¬æ•°æ®é›†åˆçš„ä½ç½®
        &quot;&quot;&quot;
        if self.index &gt; len(self.collection) - 1:
            raise StopIteration

        value = self.collection[self.index]
        self.index += 1

        return value

# æˆ‘ä»¬ç°åœ¨å¯ä»¥éå†æˆ‘ä»¬çš„è‡ªå®šä¹‰ Foo ç±»äº†ï¼
for element in Foo([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]):
    print(element)</code></pre><blockquote><p>æ³¨æ„ï¼š æŠ›å‡º <code>StopIteration</code> å¼‚å¸¸æ˜¯æ­£ç¡®å®ç°ä¸€ä¸ªè¿­ä»£å™¨çš„å¿…è¦æ¡ä»¶ã€‚</p></blockquote><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥<strong>æ‰‹åŠ¨</strong>è¿­ä»£æˆ‘ä»¬çš„<code>Foo</code>ç±»ï¼Œç”¨<code>iter and next</code>å‡½æ•°ï¼Œå°±åƒè¿™æ ·ï¼š</p><pre><code class="python">foo = Foo(list(&quot;abc&quot;))
iterator = iter(foo)

next(iterator)  # &#39;a&#39;
next(iterator)  # &#39;b&#39;
next(iterator)  # &#39;c&#39;</code></pre><blockquote><p>æ³¨æ„ï¼š<code>iter(foo)</code> å’Œ <code>foo.__iter__()</code>ç›¸åŒï¼Œè€Œ<code>next(iterator)</code> å’Œ <code>iterator.__next__()</code>ç›¸åŒâ€”â€”æ‰€ä»¥è¿™äº›å‡½æ•°éƒ½æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„åŸºç¡€è¯­æ³•ç³–ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ›´æ¸…çˆ½ã€‚</p></blockquote><p>è¿™ç§ç±»å‹çš„è¿­ä»£å™¨è¢«å«åšâ€™åŸºäºç±»çš„è¿­ä»£å™¨<code>(class-based iterator)</code>â€˜ï¼Œä¸æ˜¯å”¯ä¸€å®ç°å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•ã€‚<a href="https://www.integralist.co.uk/posts/python-generators/#generators" target="_blank" rel="noopener">ç”Ÿæˆå™¨</a>ä»¥åŠ<a href="https://www.integralist.co.uk/posts/python-generators/#generator-expressions" target="_blank" rel="noopener">ç”Ÿæˆå™¨è¡¨è¾¾å¼</a>(è¯·å‚è€ƒä»¥ä¸‹ç« èŠ‚)æ˜¯å¦ä¸€äº›èŠ‚çœå†…å­˜çš„è¿­ä»£å¯¹è±¡çš„æ–¹å¼ã€‚<br>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨<code>list</code>æ–¹æ³•æå–æ‰€æœ‰é›†åˆï¼Œå°±åƒè¿™æ ·ï¼š</p><pre><code class="python">iterator = Foo(list(&quot;abc&quot;))
list(iterator)</code></pre><blockquote><p>æ³¨æ„ï¼šå°å¿ƒç‚¹ï¼Œå› ä¸ºå¦‚æœè¿­ä»£å™¨äº§ç”Ÿæ— æ•°çš„å…ƒç´ ï¼Œä¹‹åå°±ä¼šè€—å°½ä½ åº”ç”¨çš„æ‰€æœ‰å†…å­˜ï¼</p></blockquote><h3 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h3><hr><p>æ ¹æ®å®˜æ–¹<a href="https://docs.python.org/3.7/library/stdtypes.html#generator-types" target="_blank" rel="noopener">Pythonæ–‡æ¡£</a>,â€™ç”Ÿæˆå™¨â€™æä¾›â€¦</p><blockquote><p>ä¸€ä¸ªç®€ä¾¿çš„æ–¹å¼å»å®ç°å¯è¿­ä»£åè®®ã€‚å¦‚æœä¸€ä¸ªå®¹å™¨å¯¹è±¡çš„<code>__iter__()</code>æ–¹æ³•è¢«ä½œä¸ºä¸€ä¸ªç”Ÿæˆå™¨å®ç°ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚</p></blockquote><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ</h3><p>ä»–ä»¬ä¸ä»…ä¸ºäº†åˆ›å»ºç®€å•çš„è¿­ä»£å™¨æä¾›äº†å¾ˆå¥½çš„è¯­æ³•ï¼Œè€Œä¸”å¯ä»¥å¸®åŠ©å‡å°‘è®©ä¸€äº›ä¸œè¥¿å¯è¿­ä»£æ‰€éœ€çš„æ¨¡ç‰ˆä»£ç ã€‚</p><p>ä¸€ä¸ªç”Ÿæˆå™¨å¯ä»¥å¸®åŠ©å‡å°‘ä¸â€™åŸºäºç±»â€™çš„è¿­ä»£å™¨ç›¸å…³çš„æ¨¡ç‰ˆä»£ç ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥è¢«è®¾è®¡æ¥å»å¤„ç†â€™çŠ¶æ€ç®¡ç†(<code>state management</code>)â€™é€»è¾‘ï¼Œå¦åˆ™ä½ ä¸å¾—ä¸è‡ªå·±ç¼–å†™ã€‚</p><h3 id="ç”Ÿæˆå™¨çš„å®ç°"><a href="#ç”Ÿæˆå™¨çš„å®ç°" class="headerlink" title="ç”Ÿæˆå™¨çš„å®ç°"></a>ç”Ÿæˆå™¨çš„å®ç°</h3><p>ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›â€™ç”Ÿæˆå™¨è¿­ä»£å™¨<code>(gerator iterator)</code>â€˜çš„å‡½æ•°ï¼Œæ‰€ä»¥å®ƒçš„è¡Œä¸ºå’Œ<code>__iter__</code>å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼ˆè®°ä½å®ƒè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼‰ã€‚</p><p>å®é™…ä¸Šï¼Œç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨çš„å­ç±»ã€‚ç”Ÿæˆå™¨å‡½æ•°æœ¬èº«åº”è¯¥åˆ©ç”¨<code>yield</code>è¯­å¥å°†æ§åˆ¶æƒè¿”å›ç»™ç”Ÿæˆå™¨å‡½æ•°çš„è°ƒç”¨æ–¹ã€‚</p><p>è°ƒç”¨æ–¹åœ¨ä¹‹åå¯ä»¥é€šè¿‡<code>for-in</code>è¯­å¥æˆ–è€…<code>next</code>å‡½æ•°æ¥æ¨è¿›ç”Ÿæˆå™¨è¿­ä»£å™¨ï¼ˆå’Œæˆ‘ä»¬ä¹‹å‰çš„â€™åŸºäºç±»â€™çš„è¿­ä»£å™¨çš„ä¾‹å­ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼‰ï¼Œè¿™å†æ¬¡çªå‡ºäº†ç”Ÿæˆå™¨å®é™…ä¸Šæ˜¯è¿­ä»£å™¨çš„å­ç±»ã€‚</p><p>å½“ç”Ÿæˆå™¨<code>yields</code>æ—¶ï¼Œå®ƒå®é™…ä¸Šåœ¨é‚£æ—¶å€™æš‚åœäº†å‡½æ•°å¹¶è¿”å›äº†ä¸€ä¸ªå€¼ã€‚è°ƒç”¨<code>next</code>ï¼ˆæˆ–è€…ä½œä¸º<code>for-in</code>çš„ä¸€éƒ¨åˆ†ï¼‰å°†ä¼šæ¨è¿›å‡½æ•°ï¼Œè¦ä¹ˆç§»åŠ¨åˆ°ç”Ÿæˆå™¨å‡½æ•°ç»“æŸæˆ–è€…åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­çš„ä¸‹ä¸€ä¸ª<code>yield</code>å£°æ˜å¤„åœæ­¢ã€‚</p><h3 id="ç”Ÿæˆå™¨ç¤ºä¾‹"><a href="#ç”Ÿæˆå™¨ç¤ºä¾‹" class="headerlink" title="ç”Ÿæˆå™¨ç¤ºä¾‹"></a>ç”Ÿæˆå™¨ç¤ºä¾‹</h3><p>ä¸‹é¢çš„ä¾‹å­å°†ä¼šå…ˆæ‰“å° <code>a</code>, ç„¶å<code>b</code>ï¼Œæœ€å<code>c</code>ï¼š</p><pre><code class="python">def generator():
    yield &quot;a&quot;
    yield &quot;b&quot;
    yield &quot;c&quot;

for v in generator():
    print(v)</code></pre><p>å¦‚æœæˆ‘ä»¬ç”¨<code>next()</code>å‡½æ•°ä½œä¸ºæ›¿ä»£ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><pre><code class="python">gen = generator()
next(gen)  # a
next(gen)  # b
next(gen)  # c
next(gen)  # raises StopIteration</code></pre><p>æ³¨æ„ï¼Œå’Œæˆ‘ä»¬æ—©æœŸè‡ªå®šä¹‰â€™åŸºäºç±»â€™è¿­ä»£å™¨ç›¸æ¯”ï¼Œæˆ‘ä»¬å·²ç»å¤§å¤§çš„å‡å°‘äº†æˆ‘ä»¬çš„ä»£ç æ ·æ¿ï¼Œå› ä¸ºä¸éœ€è¦å†å»åœ¨ç±»ç¤ºä¾‹ä¸Šå®šä¹‰<code>__iter__ and __next__</code>æ–¹æ³•ï¼ˆæˆ‘ä»¬è‡ªå·±ä¹Ÿä¸éœ€è¦ç®¡ç†ä»»ä½•çŠ¶æ€ï¼‰ã€‚æˆ‘ä»¬ç®€å•åœ°è°ƒç”¨<code>yield</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ä½¿ç”¨è¶³å¤Ÿç®€å•ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨å°±å¤Ÿäº†ã€‚å¦åˆ™å¦‚æœæˆ‘ä»¬éœ€è¦æ‰§è¡Œéå¸¸ç‰¹æ®Šçš„é€»è¾‘ï¼Œå¯èƒ½å°±éœ€è¦è‡ªå®šä¹‰â€™åŸºäºç±»â€™çš„ç”Ÿæˆå™¨äº†ã€‚</p><p>è®°ä½ï¼Œè¿­ä»£å™¨ï¼ˆä»¥åŠç”Ÿæˆå™¨æ‰©å±•ï¼‰æ˜¯éå¸¸èŠ‚çœå†…å­˜çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç”Ÿæˆæ— é™å¤šå…ƒç´ çš„ç”Ÿæˆå™¨ï¼Œå°±åƒè¿™æ ·ï¼š</p><pre><code class="python">def unbouded_generator():
    while True:
        yield &quot;some value&quot;

gen = unbouded_generator()

next(gen)  # some value
next(gen)  # some value
next(gen)  # some value
next(gen)  # some value
next(gen)  # ...

# è¯‘è€…æ³¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…³é—­æˆ–è€…æŠ›å‡ºå¼‚å¸¸æ¥ç»“æŸç”Ÿæˆå™¨ï¼Œå°±åƒè¿™æ ·
gen.close()
next(gen)  # StopIteration
gen.throw(ValueError(&quot;Too many balue&quot;))  # ValueError</code></pre><p>æ‰€ä»¥ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œå½“å¯¹ç”Ÿæˆå™¨å‡½æ•°ç”¨<code>list()</code>çš„æ—¶å€™ä¹Ÿè¦å°å¿ƒï¼ˆè§ä¸‹é¢çš„ä¾‹å­ï¼‰ï¼Œå› ä¸ºè¿™å°†è·å–æ•´ä¸ªé›†åˆï¼Œå¯èƒ½è€—å°½ä½ åº”ç”¨çš„å†…å­˜ã€‚</p><pre><code class="python">def generator():
    yield &quot;a&quot;
    yield &quot;b&quot;
    yield &quot;c&quot;

gen = generator()
list(gen)  # [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code></pre><h3 id="ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><p>æ ¹æ®å®˜æ–¹çš„<a href="https://www.python.org/dev/peps/pep-0289/" target="_blank" rel="noopener">PEP 289æ–‡æ¡£</a>ï¼Œå¯¹äºç”Ÿæˆå™¨è¡¨è¾¾å¼â€¦</p><blockquote><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åˆ—è¡¨æ¨å¯¼å¼çš„ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œçœå†…å­˜çš„æ³›åŒ–ã€‚</p></blockquote><p>æœ¬è´¨ä¸Šå®ƒä»¬æ˜¯ä¸€ç§ç”¨ä¸<a href="https://gist.github.com/e5310d1082b0ff8307e39b71a6f9bae5" target="_blank" rel="noopener">åˆ—è¡¨æ¨å¯¼å¼</a>ç›¸ä¼¼çš„è¯­æ³•åˆ›å»ºç”Ÿæˆå™¨çš„æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¼šæ‰“å°<code>&quot;foo&quot;</code>5æ¬¡çš„ç”Ÿæˆå™¨å‡½æ•°çš„ç¤ºä¾‹ï¼š</p><pre><code class="python">def generator(limit):
    for i in range(limit):
        yield &quot;foo&quot;

for v in generator(5):
    print(v)</code></pre><p>è¿™å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„ï¼š</p><pre><code class="python">for v in (&quot;foo&quot; for i in range(5)):
    print(v)</code></pre><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„è¯­æ³•ä¹Ÿå’Œæ¨å¯¼å¼çš„è¯­æ³•å¾ˆç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨æˆ‘ä»¬ä½¿ç”¨<code>()</code>æ›¿ä»£äº†è¾¹ç•Œ/åˆ†ç•Œç¬¦<code>[] or {}</code>ã€‚</p><pre><code class="python">(expression for item in collection if condition)</code></pre><blockquote><p>æ³¨æ„ï¼š å°½ç®¡æ²¡æœ‰æ¼”ç¤ºï¼Œå› ä¸ºæ”¯æŒ<code>&quot;if&quot;</code>æ¡ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥è¿‡æ»¤ç”Ÿæˆå€¼ã€‚</p></blockquote><h3 id="ç”Ÿæˆå™¨åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šyield-fromï¼‰"><a href="#ç”Ÿæˆå™¨åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šyield-fromï¼‰" class="headerlink" title="ç”Ÿæˆå™¨åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šyield fromï¼‰"></a>ç”Ÿæˆå™¨åµŒå¥—ï¼ˆä¾‹å¦‚ï¼šyield fromï¼‰</h3><p>Python 3.3 æä¾›äº† <code>yield from</code>è¯­å¥ï¼Œæä¾›äº†ä¸€äº›åŸºç¡€è¯­æ³•ç³–æ¥å¤„ç†åµŒå¥—ç”Ÿæˆå™¨ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚æœæ²¡æœ‰<code>yield from</code>æˆ‘ä»¬éœ€è¦æ€ä¹ˆåšï¼š</p><pre><code class="python">def baz():
    for i in range(10):
        yield i

def bar():
    for i in range(5):
        yield i

def foo():
    for v in bar():
        yield v
    for v in baz():
        yield v

for v in foo():
    print(v)</code></pre><p>æ³¨æ„æˆ‘ä»¬æœ‰ä¸¤ä¸ªå•ç‹¬çš„<code>for-in</code>å¾ªç¯ï¼ˆåœ¨<code>foo</code>ç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼‰ï¼Œæ¯ä¸ªå¾ªç¯å¯¹åº”ä¸€ä¸ªåµŒå¥—ç”Ÿæˆå™¨ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç”¨<code>yield from</code>ä¼šæ€æ ·ï¼š</p><pre><code class="python">def baz():
    for i in range(10):
        yield i

def bar():
    for i in range(5):
        yield i

def foo():
    yield from baz()
    yield from bar()

for v in foo():
    print(v)</code></pre><p>Ok è¿™å¹¶ä¸æ˜¯å¾ˆçªå‡ºçš„åŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœä½ æ›¾ç»å¯¹<code>yield from</code>å¾ˆç–‘æƒ‘ï¼Œä½ ç°åœ¨çŸ¥é“äº†å®ƒæ˜¯<code>for-in</code>è¯­æ³•çš„ç®€å•ç‰ˆå¤–è§‚ã€‚</p><p>å°½ç®¡å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰<code>yield from</code>ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨<code>itertool</code>æ¨¡å—çš„<code>chain()</code>å‡½æ•°æ¥æ”¹å†™æˆ‘ä»¬çš„åŸä»£ç ï¼Œå°±åƒè¿™æ ·ï¼š</p><pre><code class="python">from itertools import chain

def baz():
    for i in range(10):
        yield i

def bar():
    for i in range(5):
        yield i

def foo():
    for v in chain(bar(), baz()):
        yield v

for v in foo():
    print(v)</code></pre><blockquote><p>æ³¨æ„ï¼šè¯·å‚é˜…<a href="https://www.python.org/dev/peps/pep-0380/" target="_blank" rel="noopener">PEP 380</a>ä»¥è·å¾—æ›´å¤šå…³äº<code>yield from</code>çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠå°†å…¶åŒ…å«åœ¨Â·PythonÂ·è¯­è¨€ä¸­çš„åŸºæœ¬åŸç†ã€‚</p></blockquote><h3 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h3><hr><p>åç¨‹ï¼ˆå°±<code>Python</code>è€Œè¨€ï¼‰ä¸€ç›´è¢«è®¾è®¡æˆç”Ÿæˆå™¨çš„æ‰©å±•ã€‚</p><blockquote><p>åç¨‹æ˜¯è®¡ç®—æœºç¨‹åºçš„ä¸€ç±»ç»„ä»¶ï¼Œæ¨å¹¿äº†åä½œå¼å¤šä»»åŠ¡çš„å­ç¨‹åºï¼Œå…è®¸æ‰§è¡Œè¢«æŒ‚èµ·ä¸è¢«æ¢å¤ã€‚â€”â€” ç»´åŸºç™¾ç§‘</p></blockquote><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨åç¨‹ï¼Ÿ</h3><p>å› ä¸ºåç¨‹å¯ä»¥æš‚åœå’Œæ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯¹äºå¹¶å‘ç¼–ç¨‹æ¥è¯´éå¸¸åˆé€‚ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è®©ç¨‹åºå†³å®šä»€ä¹ˆæ—¶å€™â€™åˆ‡æ¢ä¸Šä¸‹æ–‡â€™ã€‚</p><p>è¿™å°±æ˜¯åç¨‹ä¸ºä»€ä¹ˆç»å¸¸è¢«ç”¨æ¥å¤„ç†ä¾‹å¦‚ï¼š<a href="https://www.integralist.co.uk/posts/python-asyncio/#event-loop" target="_blank" rel="noopener">äº‹ä»¶å¾ªç¯</a>(æ„å»ºäº<code>Python</code>çš„ <code>asyncio</code>ä¹‹ä¸Š)ã€‚</p><h3 id="åç¨‹çš„å®ç°"><a href="#åç¨‹çš„å®ç°" class="headerlink" title="åç¨‹çš„å®ç°"></a>åç¨‹çš„å®ç°</h3><p>ç”Ÿæˆå™¨ç”¨<code>yield</code>å…³é”®å­—åœ¨å‡½æ•°ä¸­åœ¨æŸæ—¶é—´ç‚¹è¿”å›å€¼ï¼Œä½†æ˜¯å¯¹äºåç¨‹ï¼Œ<code>yield</code>æŒ‡ä»¤<strong>ä¹Ÿ</strong>å¯ä»¥è¢«ç”¨åœ¨<code>=</code>æ“ä½œç¬¦çš„å³è¾¹ã€‚è¡¨ç¤ºå®ƒå¯ä»¥åœ¨è¿™ä¸ªæ—¶é—´ç‚¹<strong>æ¥æ”¶ä¸€ä¸ªå€¼</strong>ã€‚</p><h3 id="åç¨‹ç¤ºä¾‹"><a href="#åç¨‹ç¤ºä¾‹" class="headerlink" title="åç¨‹ç¤ºä¾‹"></a>åç¨‹ç¤ºä¾‹</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåç¨‹çš„ç¤ºä¾‹ã€‚è®°ä½ï¼åç¨‹ä»»ç„¶æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°æˆ‘ä»¬çš„ä¾‹å­ç”¨äº†å’Œç”Ÿæˆå™¨ç›¸å…³çš„ç‰¹æ€§ï¼ˆä¾‹å¦‚ï¼š<code>yield</code> å’Œ <code>next()</code>å‡½æ•°ï¼‰ï¼š</p><blockquote><p>æ³¨æ„ï¼šè¯·å‚è€ƒæ³¨é‡Šæ¥æé«˜å¯è¯»æ€§</p></blockquote><pre><code class="python">def foo():
    &quot;&quot;&quot;
    æ³¨æ„æˆ‘ä»¬åœ¨ä¼ ç»Ÿçš„ç”Ÿæˆå™¨å’Œåç¨‹ä¸Šéƒ½ä½¿ç”¨äº† yield
    &quot;&quot;&quot;
    msg = yield  # åç¨‹ç‰¹æ€§
    yield msg  # ç”Ÿæˆå™¨ç‰¹æ•ˆ

coro = foo()

# å› ä¸ºä¸€ä¸ªåç¨‹æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦é©±åŠ¨è¿”å›çš„ç”Ÿæˆå™¨åˆ°è¾¾ç”Ÿæˆå™¨å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ª yield
next(coro)

# .send() è¯­æ³•å¯¹äºç”Ÿæˆå™¨æ¥è¯´æ˜¯å¾ˆç‰¹åˆ«çš„ï¼Œè¿™ä¸€å¥ä»£è¡¨äº†å‘ç¬¬ä¸€ä¸ªyield å‘é€äº† &quot;bar&quot;
# msg å˜é‡å°†è¢«åˆ†é…è¿™ä¸ªå€¼
result = coro.send(&quot;bar&quot;)

# å› ä¸ºæˆ‘ä»¬çš„åç¨‹ä¹Ÿäº§ç”Ÿäº† msg å˜é‡
# è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ‰“å°å€¼
print(result)  # bar</code></pre><blockquote><p>æ³¨æ„ï¼š<code>coro</code>æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œé€šå¸¸æŒ‡ä»£ä¸€ä¸ªåç¨‹ã€‚è¦æŸ¥çœ‹å…¶ä»–æ›´å¤šçš„åç¨‹å¯ä»¥ç”¨çš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹<a href="https://docs.python.org/3.8/reference/datamodel.html#coroutines" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ç”¨åç¨‹ä½¿ç”¨<code>yield</code>åœ¨è°ƒç”¨æ–¹é€šè¿‡<code>.send()</code>æ–¹æ³•æ¥æ”¶å€¼ä¹‹å‰å‘è°ƒç”¨è€…è¿”å›äº†ä¸€ä¸ªå€¼ã€‚</p><pre><code class="python">def foo():
    msg = yield &quot;beep&quot;
    yield msg

coro = foo()

print(next(coro))  # beep

result = coro.send(&quot;bar&quot;)

print(result)  # bar</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬ç§»åŠ¨ç”Ÿæˆå™¨åç¨‹åˆ°ä¸€ä¸ª<code>first</code>è¯­å¥(ä½¿ç”¨<code>next(coro</code>)æ—¶ï¼Œå€¼<code>&quot;beep&quot;</code>è¢«è¿”å›ç»™æˆ‘ä»¬ç”¨æ¥<code>print</code>äº†ã€‚</p><h3 id="Aysncio-åŸºäºç”Ÿæˆå™¨çš„åç¨‹"><a href="#Aysncio-åŸºäºç”Ÿæˆå™¨çš„åç¨‹" class="headerlink" title="Aysncio: åŸºäºç”Ÿæˆå™¨çš„åç¨‹"></a>Aysncio: åŸºäºç”Ÿæˆå™¨çš„åç¨‹</h3><p>å½“<code>asyncio</code>æ¨¡å—é¦–æ¬¡è¢«æ¨å‡ºæ—¶ï¼Œå®ƒè¿˜ä¸æ”¯æŒ<code>async/await</code>è¯­æ³•ï¼Œå› æ­¤å½“å®ƒè¢«å¼•å…¥æ—¶ï¼Œä¸ºäº†ç¡®ä¿ä»»ä½•æœ‰éœ€è¦è¢«å¹¶å‘è¿è¡Œçš„é—ç•™ä»£ç (ä¾‹å¦‚: <code>awaited</code>)éƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ª<code>asyncio.coroutine</code>è£…é¥°å™¨å‡½æ•°ï¼Œæ¥è®©å®ƒå’Œæ–°çš„<code>async/await</code>è¯­æ³•ä¿æŒå…¼å®¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šæœ‰å…³è¿™ä¸ªè¢«å¼ƒç”¨çš„ç‰¹æ€§ï¼ˆä» <code>Python</code> 3.10å¼€å§‹ï¼‰ ï¼Œä»¥åŠä¸€äº›å…¶ä»–é€‚ç”¨äºåŸºäºåç¨‹çš„ç”Ÿæˆå™¨å‡½æ•°ï¼Œæ¯”å¦‚<code>asyncio.iscoroutine</code>çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒæ–‡æ¡£ã€‚</p></blockquote><p>æœ€åˆåŸºäºç”Ÿæˆå™¨çš„åç¨‹æ„å‘³ç€ä»»ä½•åŸºäº<code>asyncio</code>çš„ä»£ç éƒ½éœ€è¦ä½¿ç”¨<code>yield from</code>åœ¨<code>Futures</code>ä»¥åŠå¦å¤–åç¨‹ä¸Šç­‰å¾…ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åŒæ—¶ä½¿ç”¨æ–°çš„<code>async</code>åç¨‹å’Œæ—©æœŸçš„åŸºäºç”Ÿæˆå™¨çš„åç¨‹ï¼š</p><pre><code class="python">import asyncio

@asyncio.coroutine
def old_style_coroutine():
    yield from asyncio.sleep(1)

async def main():
    await old_style_coroutine()</code></pre><h3 id="Asyncio-æ–°çš„-async-åç¨‹"><a href="#Asyncio-æ–°çš„-async-åç¨‹" class="headerlink" title="Asyncio: æ–°çš„ async åç¨‹"></a>Asyncio: æ–°çš„ async åç¨‹</h3><p>ä½¿ç”¨<code>async def</code>åˆ›å»ºçš„åç¨‹æ˜¯ç”¨çš„æœ€æ–°çš„<code>__await__</code>åŒä¸‹æ–¹æ³•ï¼ˆ<a href="https://docs.python.org/3.8/reference/datamodel.html#coroutines" target="_blank" rel="noopener">æ–‡æ¡£åœ¨è¿™é‡Œ</a>ï¼‰,ç„¶è€ŒåŸºäºç”Ÿæˆå™¨çš„åç¨‹ä½¿ç”¨äº†ä¼ ç»Ÿçš„åŸºäºâ€™ç”Ÿæˆå™¨â€™çš„å®ç°ã€‚</p><h3 id="åç¨‹çš„ç§ç±»"><a href="#åç¨‹çš„ç§ç±»" class="headerlink" title="åç¨‹çš„ç§ç±»"></a>åç¨‹çš„ç§ç±»</h3><p>è¿™å¯¼è‡´äº†æœ¯è¯­â€™åç¨‹â€™åœ¨ä¸åŒçš„è¯­å¢ƒä¸‹æœ‰ä¸åŒçš„å«ä¹‰ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ï¼š</p><ul><li><code>simple coroutines</code>ï¼šä¼ ç»Ÿçš„ç”Ÿæˆå™¨åç¨‹ï¼ˆé async ioï¼‰</li><li><code>generator coroutine</code>: ç”¨ä¼ ç»Ÿçš„ <code>asyncio</code>å®ç°çš„ async io</li><li><code>native coroutines</code>ï¼šç”¨æœ€æ–°çš„ <code>async/await</code>å®ç°çš„async io</li></ul><h3 id="å…¶ä»–æ–¹é¢"><a href="#å…¶ä»–æ–¹é¢" class="headerlink" title="å…¶ä»–æ–¹é¢"></a>å…¶ä»–æ–¹é¢</h3><p><code>Python</code>æä¾›çš„ä¸€äº›æœ‰è¶£çš„è£…é¥°å™¨å‡½æ•°å¯èƒ½æœ‰ä¸€äº›è®©äººè¿·æƒ‘ï¼Œå› ä¸ºè¿™äº›å‡½æ•°çœ‹èµ·æ¥æœ‰é‡å çš„åŠŸèƒ½ã€‚</p><p>å®ƒä»¬å¹¶ä¸é‡å ï¼Œä½†ä¼¼ä¹æ˜¯ä¸€èµ·ä½¿ç”¨çš„ï¼š</p><ul><li><code>types.coroutine</code>: å°†ç”Ÿæˆå™¨å‡½æ•°è½¬ä¸ºä¸€ä¸ªåç¨‹</li><li><code>asyncio.coroutine</code>: ç¡®ä¿<code>asyncio</code>å…¼å®¹æ€§çš„æŠ½è±¡</li></ul><blockquote><p>æ³¨æ„ï¼šä¹‹åæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œ<code>asyncio.coroutine</code>å®é™…ä¸Šè°ƒç”¨äº†<code>types.coroutine</code>ã€‚åœ¨å¤„ç†<code>asyncio</code>ä»£ç æ—¶ï¼Œä½ æœ€å¥½ä½¿ç”¨å‰è€…ã€‚</p></blockquote><p>æ›´å…·ä½“çš„æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹<a href="https://github.com/python/cpython/blob/master/Lib/asyncio/coroutines.py#L105" target="_blank" rel="noopener"><code>asyncio.coroutine</code></a>ä»£ç çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ol><li>å¦‚æœè¢«è£…é¥°çš„å‡½æ•°å·²ç»æ˜¯ä¸€ä¸ªåç¨‹äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœè¢«è£…é¥°çš„å‡½æ•°æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆå°±å°†å®ƒè½¬ä¸ºåç¨‹(ä½¿ç”¨<code>types.coroutine</code>)ã€‚</li><li>å¦åˆ™è£…é¥°è¢«è£…é¥°çš„å‡½æ•°ï¼Œä»¥ä¾¿å½“å®ƒè¢«è½¬ä¸ºåç¨‹æ—¶ï¼Œå®ƒå¯ä»¥<code>await</code>ä»»ä½•å¯ä»¥ç­‰å¾…çš„ç»“æœã€‚</li></ol><p><b>æœ¬æ–‡åœ°å€ï¼š <a href="https://dustyposa.github.com/posts/a858f80b/">https://dustyposa.github.com/posts/a858f80b/</a></b></p></div><hr><div><p><span><i class="iconfont icon-inbox"></i> <a class="hover-with-bg" href="/categories/%E7%BF%BB%E8%AF%91/">ç¿»è¯‘</a> &nbsp; <a class="hover-with-bg" href="/categories/%E7%BF%BB%E8%AF%91/advance/">advance</a> &nbsp; <a class="hover-with-bg" href="/categories/%E7%BF%BB%E8%AF%91/advance/%E7%BD%91%E7%BB%9C/">ç½‘ç»œ</a> &nbsp; <a class="hover-with-bg" href="/categories/%E7%BF%BB%E8%AF%91/advance/%E7%BD%91%E7%BB%9C/%E5%BC%82%E6%AD%A5/">å¼‚æ­¥</a> &nbsp; </span>&nbsp;&nbsp; <span><i class="iconfont icon-tag"></i> <a class="hover-with-bg" href="/tags/python/">python</a> <a class="hover-with-bg" href="/tags/async/">async</a> <a class="hover-with-bg" href="/tags/generator/">generator</a> <a class="hover-with-bg" href="/tags/iterator/">iterator</a></span></p><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/posts/4a44eaec/"><i class="fa fa-chevron-left"></i> <span class="hidden-mobile">ä»é›¶å¼€å§‹æ­å»ºGithubåšå®¢(å…¶ä¸€)</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></div><div class="post-next col-6"><a href="/posts/6e2ba7b8/"><span class="hidden-mobile">å¼‚æ­¥ç½‘ç»œçˆ¬è™«</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="fa fa-chevron-right"></i></a></div></div></div><div class="comments" id="comments"><script defer src="https://utteranc.es/client.js" repo="Dustyposa/utterances_comments" issue-term="pathname" label="âœ¨ğŸ’¬âœ¨" theme="github-light" crossorigin="anonymous"></script></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc-start"></div><div id="toc"><p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div></main><a class="z-depth-1" id="scroll-top-button" href="#" role="button"><i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div id="aplayer"></div><script defer src="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css"><script type="text/javascript">var oldLoad=window.onload;window.onload=function(){new APlayer({container:document.getElementById("aplayer"),fixed:!0,autoplay:!1,loop:"all",order:"random",theme:"#b7daff",preload:"none",audio:[{name:"æ®‹é…·ãªå¤©ä½¿ã®ãƒ†ãƒ¼ã‚¼",artist:"é«˜æ©‹æ´‹å­",url:"http://m10.music.126.net/20200414114817/2c8dbf619f7695debd2cd8fd8ee1a28b/ymusic/1293/2fd3/0871/5c5be499aefc0d0be75c44bd164ce2fd.mp3",cover:"http://p1.music.126.net/45hISoQHiPTbPg9oapc7DQ==/109951163549396167.jpg?param=300x300"},{name:"Lemon",artist:"ç±³æ´¥ç„å¸«",url:"http://m10.music.126.net/20200414115729/b3a80088def180e00946d93ee8cf1bc1/ymusic/6eed/4ef2/d8ae/b85b958a70552f7e002e33d35075086c.mp3",cover:"http://p2.music.126.net/6IeZ9MiSSDXifj74nzH6ww==/109951163561494000.jpg?param=300x300"},{name:"ä¼šã„ãŸã„ã‚ˆ",artist:"æ‰‹å¡šç¿”å¤ª",url:"http://m10.music.126.net/20200414115925/cd1782ec24e4be904092e1cc8c8f2b14/ymusic/005f/0208/000f/756eb0c4af5b4cf317647e4a1d9937bd.mp3",cover:"http://p2.music.126.net/4e3vc5Ln8LDAaFhDIQ3edA==/109951164200567437.jpg?param=300x300"},{name:"Letter Song",artist:"ãƒ²ã‚¿ã¿ã‚“",url:"http://m10.music.126.net/20200414120110/f7bb09b798f9f7356a7d8a93a5dacd49/ymusic/69ac/4de3/50dd/83641cc97754d3d13e6108d3592a1569.mp3",cover:"http://p1.music.126.net/zJae2lg6igf-mBb5vbecew==/3099523278777600.jpg?param=300x300"},{name:"åƒ•ãŒæ­»ã®ã†ã¨æ€ã£ãŸã®ã¯",artist:"ä¸­å³¶ç¾å˜‰",url:"http://m10.music.126.net/20200414120319/b61c2c080baaa15e2aed1f6e561b1eaf/ymusic/0e59/045a/055b/93a3571c63307294b78421b5429712de.mp3",cover:"http://p1.music.126.net/HE-K4mxyNGF84xlyuxx9Wg==/109951163825342747.jpg?param=300x300"},{name:"å…‰ã‚‹ãªã‚‰",artist:"Goose house",url:"http://m10.music.126.net/20200414120534/610c5e83d449beefff96ac93fc5bdaf6/ymusic/9e0a/6075/ec14/a0338148b6233f2b8a48286db4125b50.mp3",cover:"http://p2.music.126.net/TM6SM2-ppcd1F66YyjR-Eg==/2537672838610591.jpg?param=300x300"}]}),oldLoad&&oldLoad()}</script><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>Fluid</b></a></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js"></script><script>$(document).ready(function(){var s=$("#navbar").height(),c=$("#toc"),t=$("#board-ctn"),o=t.offset().top,i=2*o+t.height();$(window).scroll(function(){var t=$("#toc-start").offset().top-s,o=document.body.scrollTop+document.documentElement.scrollTop;t<=o&&o<=i?c.css({display:"block",position:"fixed",top:s}):o<=t?c.css({position:"",top:""}):i<o&&c.css("display","none")}),tocbot.init({tocSelector:"#tocbot",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,headingsOffset:-o}),0<$(".toc-list-item").length&&$("#toc > p").css("visibility","visible");var l=t.css("margin-right");$("#toc-ctn").css({right:l})})</script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-163481315-1","auto"),ga("send","pageview")</script><script src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js"></script><script>$(document).ready(function(){$("pre").addClass("prettyprint  "),prettyPrint()})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","iterators,generators,coroutines&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "â¡"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){getSearchFile(path),this.onclick=null}</script><script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script>$("#post img:not(.no-zoom img, img[no-zoom])").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script>!function(e,r,t){var o,n=[];e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},function(t){var a=r.createElement("style");a.type="text/css";try{a.appendChild(r.createTextNode(t))}catch(e){a.styleSheet.cssText=t}r.getElementsByTagName("head")[0].appendChild(a)}(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),o="function"==typeof e.onclick&&e.onclick,e.onclick=function(e){var t,a;o&&o(),t=e,(a=r.createElement("div")).className="heart",n.push({el:a,x:t.clientX-5,y:t.clientY-5,scale:1,alpha:1,color:"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"}),r.body.appendChild(a)},function e(){for(var t=0;t<n.length;t++)n[t].alpha<=0?(r.body.removeChild(n[t].el),n.splice(t,1)):(n[t].y--,n[t].scale+=.004,n[t].alpha-=.013,n[t].el.style.cssText="left:"+n[t].x+"px;top:"+n[t].y+"px;opacity:"+n[t].alpha+";transform:scale("+n[t].scale+","+n[t].scale+") rotate(45deg);background:"+n[t].color+";z-index:99999");requestAnimationFrame(e)}()}(window,document)</script><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/ni-j.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body></html>